# Implementation Plan: Python Application Upgrade to Latest Version

**Branch**: `001-python-upgrade` | **Date**: 26 November 2025 | **Spec**: [spec.md](./spec.md)

## Summary

Upgrade the Python Customer Profile Service from Python 3.9.6 to Python 3.13.x to leverage security patches, performance improvements, and modern language features. The upgrade maintains full backward compatibility with existing API endpoints and functionality while using a virtual environment for dependency isolation.

## Technical Context

**Language/Version**: Python 3.13.x (upgrading from Python 3.9.6)  
**Primary Dependencies**: pytest 8.3.4, requests 2.32.3 (already compatible)  
**Storage**: In-memory database (no persistence layer)  
**Testing**: pytest with HTTP integration tests  
**Target Platform**: Development/Production servers (macOS verified, Linux expected)  
**Project Type**: Single Python application (HTTP server)  
**Performance Goals**: Health check <1s, Customer operations <500ms (match or improve Python 3.9 baseline)  
**Constraints**: Zero regression bugs, 100% test pass rate, no API changes  
**Scale/Scope**: Small service with 3 endpoints, 3 hardcoded customers, 11 existing tests

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

✅ **Single Project**: python-app is a standalone service  
✅ **Minimal Dependencies**: Only pytest and requests (testing dependencies)  
✅ **Standard Library Usage**: Uses Python's built-in http.server  
✅ **Clear Separation**: Models, database, and main server logic separated  
✅ **Test Coverage**: Comprehensive test suite exists

**No violations** - This is a straightforward runtime upgrade with no architectural changes.

## Project Structure

### Documentation (this feature)

```text
specs/001-python-upgrade/
├── plan.md              # This file
├── spec.md              # Feature specification (complete)
├── checklists/
│   └── requirements.md  # Validation checklist (complete)
└── tasks.md             # Will be generated by /speckit.tasks
```

### Source Code (repository root)

```text
python-app/
├── main.py              # HTTP server entry point (shebang update needed)
├── models.py            # Customer model and validation
├── database.py          # In-memory customer database
├── test_main.py         # Integration test suite
├── requirements.txt     # Python dependencies (already compatible)
├── venv/                # Python 3.13 virtual environment (to be created)
└── README.md            # Documentation (Python version reference)
```

**Structure Decision**: Existing structure is maintained. Only the Python runtime environment and shebang line require updates. The application uses Python's standard library http.server, so no code refactoring is needed.

## Implementation Strategy

### Phase Breakdown

**Phase 1: Environment Setup** (Foundation - Must complete first)
- Verify Python 3.13.x availability
- Create Python 3.13.x virtual environment
- Install dependencies in new environment
- Verify dependency compatibility

**Phase 2: User Story 1 - Core Application Functionality (P1)** (MVP)
- Update shebang to python3.13
- Test application startup
- Verify health check endpoint
- Verify root endpoint

**Phase 3: User Story 2 - Customer Data Operations (P2)**
- Test GET /customers/{id} endpoint
- Test PATCH /customers/{id} endpoint
- Verify error handling (404 responses)
- Verify data persistence in memory

**Phase 4: User Story 3 - Test Suite Validation (P3)**
- Run full pytest test suite
- Verify all 11 tests pass
- Check for deprecation warnings
- Verify performance matches or improves baseline

**Phase 5: Security & Documentation**
- Verify Python 3.13 security patches
- Check dependencies for vulnerabilities
- Update README.md if needed
- Document upgrade completion

### MVP Definition

**Minimum Viable Product**: Phase 2 (User Story 1) complete
- Application runs on Python 3.13.x
- Health check responds successfully
- No startup errors

This represents a working upgraded application that can be verified before proceeding to full validation.

### Parallel Execution Opportunities

- **None during setup**: Virtual environment creation must complete before any testing
- **After setup**: Testing different endpoints can be done in parallel
- **Independent user stories**: US2 and US3 can be validated concurrently after US1 passes

### Dependencies

```
Setup (Phase 1)
    ↓
US1: Core Functionality (Phase 2) ← MVP milestone
    ↓
US2: Data Operations (Phase 3) ──┐
US3: Test Validation (Phase 3) ──┤ ← Can run in parallel
    └──────────────────────────────┘
    ↓
Security & Docs (Phase 5)
```

## Technical Approach

### Runtime Environment

1. **Virtual Environment Creation**
   - Use `python3.13 -m venv venv` for isolation
   - Ensures no system-wide package conflicts
   - Follows Python best practices

2. **Dependency Installation**
   - Install from requirements.txt
   - Verify versions: pytest==8.3.4, requests==2.32.3
   - Both packages confirmed compatible with Python 3.13

3. **Application Updates**
   - Update shebang from `#!/usr/bin/env python3` to `#!/usr/bin/env python3.13`
   - No code logic changes required
   - Standard library http.server is stable across versions

### Testing Strategy

1. **Startup Validation**
   - Application launches without errors
   - Listens on expected port (8000)
   - Logs display correctly

2. **Endpoint Verification**
   - Manual testing with curl for quick validation
   - Automated pytest suite for comprehensive coverage
   - Performance comparison with Python 3.9 baseline

3. **Regression Testing**
   - All 11 existing tests must pass
   - No new deprecation warnings
   - Response times match or improve

### Security Verification

1. **Python Version Check**
   - Confirm Python 3.13.x includes patches for known CVEs
   - Document security improvements over Python 3.9

2. **Dependency Audit**
   - Verify pytest 8.3.4 has no known vulnerabilities
   - Verify requests 2.32.3 has no known vulnerabilities
   - Use `pip list --outdated` to check for updates

## Risk Mitigation

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Python 3.13 not available on system | Low | High | Verified available (3.13.9 installed) |
| Dependencies incompatible | Low | High | Pre-verified compatibility |
| Performance regression | Low | Medium | Baseline testing before/after |
| Standard library behavior changes | Very Low | Medium | http.server is stable, comprehensive tests |
| Virtual environment creation fails | Very Low | Low | Standard Python tooling, well-documented |

## Success Validation

### Automated Checks

- [ ] `python3.13 --version` returns 3.13.x
- [ ] `source venv/bin/activate && python --version` returns 3.13.x
- [ ] `source venv/bin/activate && pytest test_main.py -v` shows 11/11 passed
- [ ] `curl http://localhost:8000/health` responds in <1s
- [ ] `curl http://localhost:8000/customers/1` returns customer data in <500ms

### Manual Validation

- [ ] Application starts without warnings
- [ ] All endpoints return correct data
- [ ] No deprecation warnings in logs
- [ ] Performance matches or exceeds Python 3.9

## Deliverables

1. **Updated Python environment**: Python 3.13.x virtual environment with dependencies
2. **Updated application**: Shebang updated to python3.13
3. **Test results**: All 11 tests passing on Python 3.13.x
4. **Documentation**: README.md updated if needed
5. **Security report**: Verification of Python 3.13 patches and dependency status

## Complexity Tracking

**No violations** - This implementation adheres to all constitution principles:
- Single project structure maintained
- Minimal dependencies (only testing tools)
- Standard library usage (http.server)
- Clear separation of concerns
- Comprehensive test coverage
